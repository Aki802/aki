
以下のVBAコードは、指定された要件を実行するためのものです。このコードを「test.xlsm」の標準モジュールに追加し、実行してください。

vba
コードをコピーする
Sub CopyAndSearch()
    Dim srcWb1 As Workbook
    Dim srcWb2 As Workbook
    Dim destWb As Workbook
    Dim srcPath1 As String
    Dim srcPath2 As String
    Dim srcSheet1 As Worksheet
    Dim srcSheet2 As Worksheet
    Dim destSheet As Worksheet
    Dim srcRange As Range
    Dim destRange As Range
    Dim cell As Range
    Dim foundCell As Range
    Dim lastRow As Long
    Dim rowCounter As Long
    Dim colCounter As Long
    Dim resultString As String
    
    ' 現在のブックを設定
    Set destWb = ThisWorkbook
    Set srcSheet1 = destWb.Sheets("Sheet1")
    Set destSheet = destWb.Sheets("Sheet2")
    
    ' パス1を取得し、対応するブックを開く
    srcPath1 = srcSheet1.Range("A1").Value
    If srcPath1 = "" Then Exit Sub
    Set srcWb1 = Workbooks.Open(srcPath1)
    Set srcSheet2 = srcWb1.Sheets("Sheet1")
    
    ' パス1のSheet1のB列の文字列をdestSheetのB列にコピー
    lastRow = srcSheet2.Cells(srcSheet2.Rows.Count, "B").End(xlUp).Row
    Set srcRange = srcSheet2.Range("B1:B" & lastRow)
    srcRange.Copy Destination:=destSheet.Range("B1")
    
    ' パス2を取得し、対応するブックを開く
    srcPath2 = srcSheet1.Range("A2").Value
    If srcPath2 = "" Then Exit Sub
    Set srcWb2 = Workbooks.Open(srcPath2)
    
    rowCounter = 1
    ' destSheetのB列の各セルについて、パス2のすべてのシートで検索
    For Each cell In destSheet.Range("B1:B" & lastRow)
        For Each srcSheet In srcWb2.Sheets
            Set foundCell = srcSheet.Columns("B").Find(cell.Value, LookIn:=xlValues, LookAt:=xlWhole)
            If Not foundCell Is Nothing Then
                ' 見つかった行の最も右側の文字列を取得
                colCounter = srcSheet.Cells(foundCell.Row, srcSheet.Columns.Count).End(xlToLeft).Column
                resultString = srcSheet.Cells(foundCell.Row, colCounter).Value
                ' "⇒"以外の文字列を取得
                If InStr(resultString, "⇒") > 0 Then
                    resultString = Split(resultString, "⇒")(0)
                End If
                ' D列にコピー
                destSheet.Cells(rowCounter, "D").Value = resultString
                rowCounter = rowCounter + 1
                Exit For
            End If
        Next srcSheet
    Next cell
    
    ' ソースブックを閉じる
    srcWb1.Close SaveChanges:=False
    srcWb2.Close SaveChanges:=False
    
    MsgBox "処理が完了しました。"
End Sub
このスクリプトは以下の手順で動作します：

test.xlsm の Sheet1 の A1 セルに入力されたパスのエクセルファイルを開きます。
そのエクセルファイルの Sheet1 の B 列にあるすべての文字列を test.xlsm の Sheet2 の B 列にコピーします。
test.xlsm の Sheet1 の A2 セルに入力されたパスのエクセルファイルを開きます。
test.xlsm の Sheet2 の B 列にコピーした文字列を、パス2のエクセルファイルのすべてのシートで検索し、見つかったものについてその行の最も右側の文字列を取得します。
取得した文字列から ”⇒” 以外で最も右側にある文字列を test.xlsm の Sheet2 の D 列にコピーします。
このVBAコードを使用する際は、エラーハンドリングやパスの検証を追加することをお勧めします。
